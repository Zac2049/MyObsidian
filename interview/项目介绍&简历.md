## 小型web框架
主要借鉴Gin
- `net/http`提供了基础的Web功能，即监听端口，映射静态路由，解析HTTP报文
- 整体的这个处理请求给出响应的主体，定为Engine这个struct，处理用户的GET的行为就是这个Engine的方法，监听端口并运行
- 对客户端的请求，服务端都得给出一个handler方法，封装handler的端口，自定义一个Context封装Request和ResponceWriter，Context也对
- 将router和handler的映射从分离出来，并增加routerGroup，对不同组的group采用不同的中间件，以及实现动态路由，动态路由具体采用Trie树实现，Trie树更具体是用指针数组实现的
- 中间件的实现，具体是在context下面增加middleware的handler，再增加use方法，服务端执行中间件的时候，调用这个use就行
- 还有就是一些细节，比如logger，template渲染模板

## 分布式缓存
主要借鉴groupcache
- 核心数据结构Group负责与用户的交互，并且控制缓存值存储和获取的流程，可以认为是一个缓存的命名空间。缓存不存在时，需要在本地回调时，调用回调函数，这里抽象出接口getter，本地不存在就从远程获取节点，具体采用http服务
- 手动实现LRU内存淘汰机制，具体由map和双向链表实现，淘汰队首，插入和访问时放至队尾，抽象byteView表示缓存值，之后对cache实现的修改操作进行加锁
- 简单的哈希映射没有考虑节点数量变化的场景。当节点数量变化时，几乎缓存值对应的节点都发生了改变，即几乎所有的缓存值都失效了，造成瞬时DB请求量大，即缓存雪崩。
- 引入一致性哈希。映射空间是固定的2^32，形成一个环。首先节点都放置在环上，key映射在环上的某个值，顺时针寻找第一个节点，就是其对应节点
- 数据倾斜，即节点分布比较集中，这时将映射关系从真实节点改到虚拟节点即可
- 数据击穿，相同一个端口发送大量请求，主要使用waitgroup解决，具体需要抽象出singleflight
- 缓存穿透：查询一个不存在的数据


## **自我介绍**

我研究生的课题主要是利用深度学习和计算机视觉的方法去解决医学图像分割和域适应的问题。
研究生做的有一个课题是关于FFT在深度学习和医学图像分割中的应用，这个课题总结发了一篇期刊文章。
之后有两段实习，一是在美的ai创新中心，主要做的是调研和设计解决部分标注问题。二是在透彻未来，我主要参与大规模预训练模型的训练和分割监督网络的训练，还有去生成热力图，最后是一段模型部署的经历。
最后我平时也会看一些计算机包括开发的各种的东西。

具体来说我会利用ViT的位置编码策略先给图像分块以及各个块全局位置信息，之后对图的特征进行经过全局频域块，这个全局频域块实际是对图像进行FFT再乘一个可学习的矩阵，以学习这个图像特征，再iFFT，再用卷积下采样。循环数个步骤已完成编码学习，之后decoder主要采取resnet的策略。
## 频域分割网络

- encoder， decoder
- 采取ViT的分块加位置编码
- 分别下采样，每次下采样后对feature map进行FFT，对频域图进行和一个有参数量的矩阵做乘法，再iFFT，LN
- 这个频域的实现是有
- 为什么有效。创新点？
	1. 卷积定理，两个函数或者信号在时域中的卷积等价于频域中的相乘（逐点相乘）
	2. 连续傅里叶到离散傅里叶，以便计算机的离散处理
	3. 快速傅里叶，利用傅里叶变换后频域信息的对称和周期性，从$O(n^2)$到$O(nlogn)$
	4. 频域信号更能捕捉MRI图像中的各频信息，因为许多医学图像都是有清晰的纹理和各个结构的相对位置信息。深度学习如何学习图像特征，都会做数据增强，CNN，窗口分块平移学习，ViT，图像分块token化全局相关性学习，基于FFT的，图像分块token化全局频域学习。

| arch | Param | FLOPS |
|:-:|:-:|:-:|
|self-attention| $nd^2$ (n 句子长，d embedding dim) $O\left(2 D_k N D_x+D_v N D_x+N^2 D_k+1+D_x N^2\right)=O\left(N^2\right)$ | $4d^2$ ($3d^2$是qkv计算) |
|cnn | $k^2*C_{out}*C_{in}$ (bias+1) | $k^2*C_{out}*C_{in}*WH$|
| rnn | $lnd^2$ (网络深度为$l$)||
|matrix multiply | $mn+np$ |$mnp$ -> opt $n^{2.3}$|
| Global Filter | $HWC_{in}$ | $HWC_{in} logHW+ HWC_{in}$  |

### 每个像素的变换：

对于一个二维图像，FFT涉及对每个像素进行傅里叶变换。每个像素的值表示图像中对应位置的亮度或颜色。傅里叶变换将这些像素值根据DFT的公式转换为复数形式（这里也涉及坐标转换），根据复数形式的像素值可计算幅值和相位。
经过iDFT变回时域，可以证明是一一对应的转换，进行CNN下采样。

### 得到的值的意义以及可视化：

1. **幅值：** 表示在频率域中每个频率分量的强度。高幅值对应于图像中的边缘和细节，低幅值对应于平滑的区域。

2. **相位：** 表示在频率域中每个频率分量的相对位置。相位信息对于一些图像处理任务，如图像复原和合成，非常重要。

可以对幅值图和相位图进行可视化

通过对图像进行FFT，我们可以分析其频率特征，进行频域滤波，提取特征，进行图像压缩等操作。FFT在图像处理中具有广泛的应用，特别是在计算机视觉和图像分析领域。
### 一般图像的FFT过程：

1. **选择图像：** 选择一幅灰度图像，这通常是一个二维矩阵，其中每个元素代表图像中对应位置的像素值。
2. **像素值归一化：** 将像素值从0到255归一化到-1到1之间。这是因为FFT期望输入在一定范围内，而不是在0到255之间。
3. **进行FFT：** 对图像矩阵执行二维FFT。这会将图像从空间域转换到频率域。FFT的结果是一个包含复数值的矩阵，其中每个元素对应频率域中的一个点。
4. **频率域中心化：** 对FFT结果进行中心化，将低频分量移到频谱的中心。这可以通过调用`fftshift`函数实现。
5. **取模（Magnitude）：** 取频率域矩阵的模，即复数的幅值。这反映了每个频率分量在原始图像中的贡献。
6. **取相位（Phase）：** 取频率域矩阵的相位，即复数的角度。这反映了每个频率分量在图像中的位置。

### FFT的意义
图像做FFT（快速傅里叶变换）有很多意义，其中一些主要的包括：
1. **频域分析：** FFT将图像从空间域转换到频率域。这使得我们可以分析图像中不同频率的成分。在频率域中，==**高频分量对应图像的细节和边缘，而低频分量对应图像的整体结构**==。通过分析频域信息，我们可以更好地理解图像的特征。
    
2. **滤波：** 在频域中，我们可以对图像进行滤波，以增强或减弱特定频率的成分。这可以用于去除图像中的噪声、强调特定细节，或者执行其他图像处理任务。例如，通过去除高频成分，我们可以实现模糊效果。
    
3. **压缩：** 在频域中，图像的能量通常集中在较低的频率上。这使得我们可以通过保留较低频率的信息，而丢弃高频率的信息来实现图像压缩。这是JPEG等压缩算法的基本原理之一。
    
4. **特征提取：** FFT可以用于提取图像中的特定频率的特征。这在图像识别、图像分割和其他计算机视觉任务中是有用的。
    
5. **图像处理和编辑：** 在频域中编辑图像可以导致有趣的效果。例如，通过在频域中对图像施加相位变化，我们可以实现图像的位移效果。

傅里叶变换有两个部分：实部和虚部。==实部==表示图像中的==余弦分量==，==虚部==表示图像中的==正弦分量==。而傅里叶变换的==幅值和相位==分别表示了每个频率分量的强度和相位。

对于图像中的每个像素，傅里叶变换都会计算对应频率的复数值，这样就得到了图像在频域中的表示。在计算机图像处理中，通常我们关注的是频域中的低频和高频成分，以便进行滤波、特征提取等操作。
loss =  dice loss + CE

CE对图像是逐像素的类别预测差异运算 -y(class)logp





# CLIP driven
尝试使用CLIP这种大型预训练视觉语言模型
CLIP预训练出text encoder和image encoder
- 传统医学图像语义分割都是假设各个标签是正交的关系，往往最后可用one hot编码表示，但标签实际上是有语义之间的联系，这个假设是和真实分布有偏差的。一般基于Dice loss和CE的语义分割是不大好学习这个偏差以及标签语义之间的相关性的。
- CLIP融合驱动能达到一种软标签或者说提供更多语义信息的效果
- 对每个标签，输入包括预定义prompt，比如一张什么器官的医学图像，还有一张对应的图像，这里就是保证输入的是图文的正样本对，prompt在CLIP的text encoder进行推理得到embedding，这个文本编码器是frozen的，图片经过需要训练的encoder得到编码，两个embedding进行concat，经过MLP得到参数，visual embedding经过它的decoder得到的feature map会和这个参数做卷积，和gt做损失，再反向传播。
- 这里用B dice loss，b ce，会实现根据对比空间对像素的拉取的效果

- 输入有两个词，一个text prompt， 还有一个one hot，one hot可以硬编码在图像的channel上，这样会比较消耗显存。另一种方法就是将one hot 加入旁支。
- 部分标注问题则是两个结合起来，或者利用一种即可

这里的loss是什么？
BDICE + BCE
多分类的dice也是根据Binary Dice得到的




## **部署和加速**
参与包括 YOLOv8，EfficientNet 和 DeepLab 多个视觉模型的边端部署和加速，设计 ONNX, TensorRT 推理模型转换和 CUDA 加速，以及 C++ 服务（采取json的TCP通信）

你做的部分？时间能做到多少优化

|Model|size  <br>(pixels)|mAPbox  <br>50-95|mAPmask  <br>50-95|Speed  <br>CPU ONNX  <br>(ms)|Speed  <br>A100 TensorRT  <br>(ms)|params  <br>(M)|FLOPs  <br>(B)|
|---|---|---|---|---|---|---|---|
|YOLOv8l-seg|640|52.3|42.6|572.4|2.79|46.0|220.5|


1. 模型轻量化，量化剪枝蒸馏
2. CUDA加速。C++工程，重写？
3. 通信服务

ViT basic large
ViT分类模型，怎么弄
说说各layer的特征交互情况
mask attention
全局频域中的频域怎么体现
loss怎么设计 dice loss, CE, BCE, Binary dice loss

## MarioGPT





